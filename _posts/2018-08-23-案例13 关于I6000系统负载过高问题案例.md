---
layout: post
title:  "案例13 关于I6000系统负载过高问题案例"
date:   2018-08-23 12:00:00 +0800
categories: 读书笔记
tags:  案例 运维 
author: cm
---

* content
{:toc}





> 引言：故障分享。



### 故障现象
2018年1月26日，国网某省电力公司信息通信公司负责运行管理的资产全寿命评估决策系统发生运行安全事件，资产全寿命评估决策系统I6000健康运行市场指标缺失，URL探测异常。

### 处理过程
19：40信调发现资产全寿命评估决策系统I6000监控告警，系统健康运行市场指标终端，URL探测异常，通知资产全寿命评估决策系统运维人员进行故障排查。

19：50资产全寿命评估决策系统运维人员到达现场进行故障排查，排查发现服务器性能明显低于正常水平，磁盘访问状态为busy状态且执行部分命令如1s等，需要等待超过30秒才能有输出，立即通知运维人员检查宿主机及虚拟机平台是否异常，发现虚拟机平台上有存储访问延时告警，初步确认为连接存储链路问题或者存储性能问题，导致业务及虚拟机访问受到影响。经排查，该存储与1月26日16时左右发生前段端口故障有关，该端口为营销基础数据平台所属链路端口，营销基础数据平台在只有一条链路的情况下发生运行异常，为尽快恢复营销基础数据平台性能，平台运维人员在16：40将营销基础数据平台对应的存储端口迁移至A口，即资产全寿命评估决策系统所在宿主机所连存储端口。

19：55由于营销数据平台有大量的数据交互操作，占用大量该端口带宽资源，影响了资产全寿命宿主机访问存储速度，导致该端口队列full，资产全寿命系统访问异常，由于此时主要的IO请求都为营销基础数据平台业务发起，因此营销基础数据平台其IOPS较高，压缩了其他业务访问带宽，该端口上运行的资产全寿命等系统所在宿主机出现明显访问存储延迟告警，执行多种与磁盘相关的命令如ls、fdisk、df等都出现明显等待才能出现查询结果，影响虚拟机正常运行，而营销基础数平台业务本身由于是主动发起方而受到的影响较小。

20：40运维人员再次调整该宿主机存储的链路通道，通过在SAN段新增加一个zone将B控制器B口和宿主机重新绑定，在存储端新建host并将此盘重新mapping给该主机wwn，同时在华为资源池管理平台存储配置界面重新扫描磁盘，识别到该宿主机连接存储链路已经变为到3条，再检查管理平台，虽然还存在磁盘告警，但上面运行的虚拟机执行命令已经不受影响，通过调整，缓解了当前链路压力

20：55 I6000监测恢复正常，资产全寿命系统恢复正常。

### 故障原因
资产全寿命评估决策系统与营销基础数据平台所用存储均为公用存储设备，该设备为中端设备，在设计时为避免相互影响，将营销基础数据平台及资产全寿命系统所在宿主机连接存储链路分别单独划分在不同的端口，能够满足给同存储访问性能需求。但是在营销基础数据平台一条链路端口发生损坏后，因暂无可更换的备件，且该存储已无其它空闲端口，因此运维人员将营销基础数据平台的链路暂时切换至当时流量最小的资产全寿命系统所属端口，计划待备件更换后在进行回切。在此过程中由于营销基础数据访问存储数据量过大，端口资源被营销基础数据占用，资产全寿命 磁盘等待时间过长，I6000系统取数出现延迟。
整改措施
1、密切注意监控存储个端口负载情况，发现问题及时解决。
2、有新需求时了解清楚业务规模类型，对高IOPS的业务或答应服务器，尽量不放在同一个设备上；且对大型数据库间通过迁移方式放在高端存储设备上，提高数据处理能力；
3、增加备品备件管理，发现故障及时进行处理；
4、开展各系统业务数据高峰分析，避免相近业务数据防止在同一台设备上，降低业务高峰叠加对基础设施的压力。